{% extends 'base.html' %}

{% block content %}
<div class="card p-3">
    <h3>Admin Dashboard</h3>

    <p><strong>Admin Balance:</strong> {{ admin_balance.balance|default:"0" }}</p>

    <p>
        <a class="btn btn-sm btn-outline-primary" href="{% url 'admin_view_users' %}">View All Users</a>
        <a class="btn btn-sm btn-outline-secondary" href="{% url 'admin_manage_complaints' %}">
            Manage Complaints ({{ pending_inspectors|length|default:"0" }})
        </a>
        <a class="btn btn-sm btn-outline-success" href="{% url 'admin_approve_inspectors' %}">Approve Inspectors</a>
    </p>

    <h4 class="mt-3">Inspection Requests</h4>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>ID</th>
                <th>Owner</th>
                <th>Location</th>
                <th>Status</th>
                <th>Inspector</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for r in data %}
            <tr>
                <td>{{ r.id }}</td>
                <td>{{ r.owner.username }}</td>
                <td>{{ r.building_location }}</td>
                <td>{{ r.status }}</td>
                <td>{% if r.inspector %}{{ r.inspector.username }}{% else %}-{% endif %}</td>
                <td>
                    {% if not r.inspector %}
                        <a class="btn btn-sm btn-primary" href="{% url 'admin_assign_inspector' r.id %}">Assign</a>
                    {% else %}
                        <a class="btn btn-sm btn-secondary" href="{% url 'admin_assign_inspector' r.id %}">Reassign</a>
                    {% endif %}
                    <a class="btn btn-sm btn-warning ms-1" href="{% url 'admin_set_fee' r.id %}">Set Fee</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center">No requests found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h4 class="mt-3">Pending Inspector Approvals</h4>
    <ul>
        {% if pending_inspectors %}
            {% for p in pending_inspectors %}
                <li>
                    {% if p.user %}
                        {{ p.user.username|default:"No Username" }} ({{ p.nid|default:"No NID" }})
                    {% else %}
                        Inspector data incomplete
                    {% endif %}
                </li>
            {% endfor %}
        {% else %}
            <li>No pending inspectors.</li>
        {% endif %}
    </ul>
</div>
{% endblock %}
